<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"> 

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"> 
  <head>
    <title>Page Monitor Options</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" type="image/png" href="image/browser_icon.png" />
    <link rel="stylesheet" type="text/css" href="lib/colorPicker.css" />
    <link rel="stylesheet" type="text/css" href="styles/options.css" />
    <script type="text/javascript" src="lib/jquery-1.4.1.js"></script>
    <script type="text/javascript" src="lib/jquery.colorPicker.js"></script>
    <script type="text/javascript" src="scripts/base.js"></script>
    <script type="text/javascript" src="scripts/options.js"></script>
    <script type="text/javascript">
      // <!--
      $(function() {
        // Set title.
        $('title').text(chrome.i18n.getMessage('options_title'));
        
        // Apply translations.
        $('.i18n').each(function() {
          $(this).removeClass('i18n')
                 .text(chrome.i18n.getMessage($(this).attr('title')))
                 .attr('title', '');
        });
        
        // Turn off animations if they are disabled.
        if (getSetting(SETTINGS.animations_disabled)) $.fx.off = true;
        
        // Set up the main color/timeout/animation contols.
        initializeColorPicker();
        initializeTimeoutTextbox();
        initializeSoundSelector();
        initializeAnimationToggler();
        initializeSorter();
        initializeNotificationsChecker();
        initializeExporter();
        initializeImporter();
        
        // Set up the "Check All Now" button handler.
        $('#check_now').click(function() {
          getAllPageURLs(function(pages) {
            $('.last_check_time').text(chrome.i18n.getMessage('check_in_progress') + '..');
            
            BG.check(true, $.noop, function(url) {
              $('.last_check_time', $('#pages .page_record').has('a[href=' + url + ']')).trigger('time_updated');
            });
          });
        });
        
        // Set up "rename page" live click handlers.
        $('.rename').live('click', function() {
          var record = $(this).closest('.page_record');
          var page_link = record.find('.page_link');
          
          if (!page_link.is(':hidden')) {
            var textbox = $('<input type="text" value="' + page_link.text() + '" />');
            var cancel_button = $('<input type="button" value="' + chrome.i18n.getMessage('cancel') + '" />');
            var ok_button = $('<input type="button" value="' + chrome.i18n.getMessage('ok') + '" />');
            
            cancel_button.click(function() {
              textbox.remove();
              ok_button.remove();
              cancel_button.remove();
              page_link.show();
            });
            
            ok_button.click(function() {
              page_link.text(textbox.val());
              setPageSettings(findUrl(this), { name: textbox.val() });
              cancel_button.click();
            });
            
            page_link.hide();
            page_link.after(cancel_button).after(ok_button).after(textbox);
          }
        });
        
        // Set up "stop monitoring" live click handlers.
        $('.stop_monitoring').live('click', function() {
          var url = findUrl(this);
          
          removePage(url, BG.updateBadge);
          
          var scroll_position = scrollY;
          
          $(this).closest('.page_record td').slideUp('slow', function() {
            if ($('#pages .page_record').length == 1) {
              $('#pages').animate(
                { height: '50px', opacity: 1 }, 'slow', fillPagesList
              );
            } else {
              fillPagesList();
              scrollTo(0, scroll_position);
            }
          });
        });
        
        // Set up advanced option expansion events.
        $('.advanced_toggle input[type=checkbox]').live('click', function() {
          if ($(this).is(':checked')) {
            $(this).closest('.page_record').find('.advanced_toggle').addClass('toggled');
            $(this).closest('.page_record').find('.advanced_controls').slideDown('fast');
            
            // Apply previously-set advanced settings.
            var timeout_div = $(this).closest('.page_record').find('.timeout');
            if (timeout_div.find(':checked').length > 0) {
              setPageTimeout(this, timeout_div.find('input[type=text]').val());
            }
            var regex_div = $(this).closest('.page_record').find('.regex');
            if (regex_div.find(':checked').length > 0) {
              setPageRegex(this, regex_div.find('input[type=text]').val());
            }
          } else {
            $(this).closest('.page_record').find('.advanced_controls').slideUp('fast', function() {
              $(this).closest('.page_record').find('.advanced_toggle').removeClass('toggled');
            });
            
            setPageTimeout(this, null);
            setPageRegex(this, null);
          }
        });
        
        // Set up advanced option enabling/disabling events.
        $('.advanced_controls input[type=checkbox]').live('click', function() {
          if ($(this).is(':checked')) {
            $(this).nextAll('span').addClass('enabled').removeClass('disabled');
            $(this).nextAll('span').find('input').attr({ disabled: false });
          } else {
            $(this).nextAll('span').addClass('disabled').removeClass('enabled');
            $(this).nextAll('span').find('input').attr({ disabled: true });
          }
        });
        
        $('.timeout input[type=checkbox]').live('click', function() {
          if ($(this).is(':checked')) {
            setPageTimeout(this, $(this).nextAll('span').find('input').val());
          } else {
            setPageTimeout(this, null);
          }
        });
        
        $('.mode input[type=checkbox]').live('click', function() {
          var url = findUrl(this);
          var record = $(this).closest('.page_record');
          
          if ($(this).is(':checked')) {
            $('.mode input[type=radio]:checked', record).click();
            $('.mode input[type=text]', record).keyup();
          } else {
            setPageSettings(url, { mode: 'text', regex: null, selector: null });
          }
        });
        
        // Set advanced option editing events.
        $('.timeout input[type=text]').live('keyup', function() {
          setPageTimeout(this, cleanTimeoutTextbox(this));
        });
        $('.mode input[type=text]').live('keyup', function() {
          var mode = $(this).closest('.page_record').find('input[type=radio]:checked').val();
          if (mode == 'regex') {
            setPageRegex(this, $(this).val());
          } else if (mode == 'selector') {
            setPageSelector(this, $(this).val());
          }
        });
        
        // Set up mode radio box click handler
        $('.mode input[type=radio]').live('click', function() {
          var url = findUrl(this);
          var record = $(this).closest('.page_record');
          var val = $(this).val();
          
          setPageSettings(url, { mode: val });
          $('.mode input[type=text]', record).keyup();
          
          var label = chrome.i18n.getMessage(val);
          $('.mode_value>span', record).text(label + ':');
        });
        
        // Set up regex/selector test click handler
        $('.mode input[type=button]').live('click', function() {
          var url = findUrl(this);
          getPage(url, function(page) {
            var mode = page.mode;
            var regex = page.regex;
            var selector = page.selector;
            var button = $(this);
            
            if ((mode == 'regex' && regex) || (mode == 'selector' && selector)) {
              $(this).val(chrome.i18n.getMessage('test_progress'));
              $(this).closest('.mode').find('input').attr({ disabled: true });
              $.ajax({
                url: url,
                success: function(html) {
                  var results = '';
                  if (mode == 'regex') {
                    results = findAndFormatRegexMatches(html, regex);
                  } else {
                    results = findAndFormatSelectorMatches(html, selector);
                  }
                  
                  setPageSettings(url, { crc: cleanAndHashPage(html, mode, regex, selector) });
                  
                  if (results) {
                    alert(chrome.i18n.getMessage('test_matches') +'\n' + results);
                  } else {
                    alert(chrome.i18n.getMessage('test_no_matches'));
                  }
                },
                error: function() {
                  alert(chrome.i18n.getMessage('test_fail'));
                },
                complete: function() {
                  button.val(chrome.i18n.getMessage('test_button'));
                  button.closest('.mode').find('input').attr({ disabled: false });
                }
              });
            }
          });
        });
        
        // Finally, fill the pages list.
        fillPagesList();
      });
      // -->
    </script>
  </head>
  <body>
    <h1><span class="i18n" title="options_header"></span></h1>
    <table id="templates">
      <tr class="page_record">
        <td>
          <div class="page_info">
            <img class="favicon" src="img/page.png" alt="Favicon" />
            <a class="page_link" title="Visit Page" href="#">Page</a>
          </div>
          <div class="page_controls">
            <label class="util active advanced_toggle">
              <!--img src="img/plus.png" /-->
              <input type="checkbox" />
              <span class="i18n" title="advanced"></span>
            </label>
            <span class="util active rename">
              <img src="img/rename.png" alt="Rename" />
              <span class="i18n" title="rename_page"></span>
            </span>
            <span class="util active stop_monitoring">
              <img src="img/stop_monitoring.png" alt="Stop Monitoring" />
              <span class="i18n" title="stop_monitoring"></span>
            </span>
            <span class="util last_check inactive">
              <img src="img/monitor.png" alt="Last Check" />
              <span class="i18n" title="last_check"></span>
              <span class="last_check_time"><span class="i18n" title="unknown"></span></span>.
            </span>
            <div class="advanced_controls">
              <div class="timeout">
                <input type="checkbox" />
                <span class="disabled">
                  <span class="i18n" title="check_every"></span>
                  <input type="text" disabled="disabled" />
                </span>
              </div>
              <div class="mode">
                <input type="checkbox" />
                <span class="mode_selector disabled">
                  <span class="i18n" title="custom_mode"></span>
                  <label>
                    <input type="radio" name="mode" value="regex" disabled="disabled" />
                    <span class="i18n" title="regex"></span>
                  </label>
                  <label>
                    <input type="radio" name="mode" value="selector" disabled="disabled" />
                    <span class="i18n" title="selector"></span>
                  </label>
                  <br />
                  <span class="mode_value">
                    <span><span class="i18n" title="regex"></span>:</span>
                    <input type="text" disabled="disabled" />
                    <input type="button" disabled="disabled" value="Test" />
                  </span>
                </span>
              </div>
            </div>
          </div>
        </td>
      </tr>
      <tr class="empty">
        <td>
          <span class="i18n" title="no_pages_monitored"></span>
        </td>
      </tr>
    </table>
    
    <table id="pages" cellspacing="0">
      <!-- Pages go here. -->
    </table>
    <p class="main_controls">
      <span class="util inactive doublewide" id="notifications">
        <img src="img/notification.png" alt="Desktop Notifications" />
        <span class="i18n" title="notifications"></span>
        <select>
          <option value="enabled" class="i18n" title="enabled"></option>
          <option value="disabled" class="i18n" title="disabled"></option>
        </select>
        <span class="i18n" title="notifications_timeout"></span>
        <input type="text" value="30" maxlength="5" />
      </span>
      <span class="util inactive" id="badge_color">
        <img src="img/color.png" alt="Badge Color" />
        <span class="i18n" title="badge_color"></span>
        <input type="text" value="#00B400" />
      </span>
    </p>
    <p class="main_controls">
      <span class="util active" id="check_now">
        <img src="img/refresh.png" alt="Check Now" />
        <span class="i18n" title="check_all"></span>
      </span>
      <span class="util inactive" id="global_timeout">
        <img src="img/clock.png" alt="Check Interval" />
        <span class="i18n" title="check_every"></span>
        <input type="text" value="180" maxlength="5" />
      </span>
    </p>
    <p class="main_controls">
      <span class="util inactive doublewide" id="sound_alert">
        <img src="img/sound.png" alt="Audio Alert" />
        <span class="i18n" title="sound_alert"></span>
        <select>
          <option value="" class="i18n" title="sound_none"></option>
          <option value="http://work.max99x.com/cuckoo.ogg" class="i18n" title="sound_cuckoo"></option>
          <option value="http://work.max99x.com/bell.ogg" class="i18n" title="sound_chime"></option>
        </select>
        <button id="play_sound"><span class="i18n" title="sound_play"></span></button>
        <button id="new_sound"><span class="i18n" title="sound_new"></span></button>
      </span>
    </p>
    <p class="main_controls">
      <span class="util inactive" id="sort">
        <img src="img/sort.png" alt="Sort By" />
        <span class="i18n" title="sort"></span>
        <select>
          <option value="date added" class="i18n" title="sort_date"></option>
          <option value="name" class="i18n" title="sort_name"></option>
          <option value="URL" class="i18n" title="sort_url"></option>
          <option value="check interval" class="i18n" title="sort_interval"></option>
          <option value="last check" class="i18n" title="sort_last_check"></option>
          <option value="last change" class="i18n" title="sort_last_change"></option>
        </select>
      </span>
      <span class="util inactive" id="animation">
        <img src="img/animation.png" alt="Animation" />
        <span class="i18n" title="animations"></span>
        <select>
          <option value="enabled" class="i18n" title="enabled"></option>
          <option value="disabled" class="i18n" title="disabled"></option>
        </select>
      </span>
    </p>
    <p class="main_controls">
      <span class="util active" id="import">
        <img src="img/import.png" alt="Import" />
        <span class="i18n" title="import"></span>
      </span>
      <span class="util active" id="export">
        <img src="img/export.png" alt="Export" />
        <span class="i18n" title="export"></span>
      </span>
    </p>
    <div id="export_form">
      <span class="i18n" title="export_prompt"></span>
      <textarea rows="10" cols="80">...</textarea>
      <button><span class="i18n" title="close"></span></button>
    </div>
    <div id="import_form">
      <span class="i18n" title="import_prompt"></span>
      <textarea rows="10" cols="80"></textarea>
      <button id="import_perform"><span class="i18n" title="import_button"></span></button>
      <button id="import_cancel"><span class="i18n" title="cancel"></span></button>
    </div>
    <div id="new_sound_form">
      <label><span class="i18n" title="sound_name"></span></label>
      <input type="text" id="new_sound_name" value="" />
      <label><span class="i18n" title="sound_url"></span></label>
      <input type="text" id="new_sound_url" value="" />
      <div id="new_sound_buttons">
        <button id="new_sound_create"><span class="i18n" title="sound_create"></span></button>
        <button id="new_sound_cancel"><span class="i18n" title="cancel"></span></button>
      </div>
    </div>
  </body>
</html>