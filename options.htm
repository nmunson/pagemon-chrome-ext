<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Page Monitor Options</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="shortcut icon" type="image/png" href="image/browser_icon.png" />
  <link rel="stylesheet" type="text/css" href="lib/colorPicker.css" />
  <link rel="stylesheet" type="text/css" href="styles.css" />
  <link rel="stylesheet" type="text/css" href="styles_options.css" />
  <script type="text/javascript" src="lib/jquery-1.4.1.js"></script>
  <script type="text/javascript" src="lib/jquery.colorPicker.js"></script>
  <script type="text/javascript" src="monitor.js"></script>
  <script type="text/javascript">
    // Background graying function, based on: 
    // http://www.hunlock.com/blogs/Snippets:_Howto_Grey-Out_The_Screen
    function grayOut(show, id_prefix) {
      // Pass true to gray out screen, false to ungray.
      var dark_id = (id_prefix || '') + '_shader';
      var dark = document.getElementById(dark_id);
      var first_time = (dark == null);
      
      if (first_time) {
        // First time - create shading layer.
        var dark = document.createElement('div');
        dark.id = dark_id;
        
        dark.style.position = 'absolute';
        dark.style.top = '0px';
        dark.style.left = '0px';
        dark.style.overflow = 'hidden';
        dark.style.opacity = '0';
        dark.style['-webkit-transition'] = 'opacity 0.5s ease';
        
        document.body.appendChild(dark);
      }
      
      if (show) {
        // Set the shader to cover the entire page and make it visible.
        dark.style.zIndex = 1;
        dark.style.backgroundColor = '#000000';
        dark.style.width = document.body.scrollWidth + 'px';
        dark.style.height = document.body.scrollHeight + 'px';
        dark.style.display = 'block';
        
        setTimeout(function() {dark.style.opacity = 0.7;}, 100);
      } else if (dark.style.opacity != 0) {
        setTimeout(function() {dark.style.opacity = 0;}, 100);
        setTimeout(function() {dark.style.display = 'none';}, 600);
      }
    }

    function initializeColorPicker() {
      var toHex = function(d) {
        return d >= 16 ? d.toString(16) : '0' + d.toString(16);
      }
      
      var badge_color = getSetting(SETTINGS.badge_color);
      var badge_color = '#' + toHex(badge_color[0]) + 
                              toHex(badge_color[1]) +
                              toHex(badge_color[2]);
      
      $('#badge_color input').val(badge_color).change(function() {
        var color = $(this).val();
      
        setSetting(SETTINGS.badge_color, [parseInt(color.slice(1,3), 16),
                                          parseInt(color.slice(3,5), 16),
                                          parseInt(color.slice(5,7), 16),
                                          255]);
        BG.updateBadge();
      }).colorPicker();
    }
      
    function initializeAnimationToggler() {
      $('#animation select').change(function() {
        var disabled = ($(this).val() != 'enabled');
        setSetting(SETTINGS.animations_disabled, disabled);
        $.fx.off = disabled;
      }).val(getSetting(SETTINGS.animations_disabled) ? 'disabled' : 'enabled');
    }
    
    function initializeSorter() {
      $('#sort select').change(function() {
        setSetting(SETTINGS.sort_by, $(this).val());
        fillPagesList();
      }).val(getSetting(SETTINGS.sort_by) || 'date added');
    }
    
    function initializeNotificationsChecker() {
      if (window.webkitNotifications.checkPermission() != 0) {
        setSetting(SETTINGS.notifications_enabled, false);
      }
      
      $('#notifications select').change(function() {
        var $this = $(this);
      
        var enabled = ($this.val() == 'enabled');
        if (enabled) {
          if (window.webkitNotifications.checkPermission() == 0) {
            setSetting(SETTINGS.notifications_enabled, true);
          } else {
            $this.val('disabled');
            webkitNotifications.requestPermission(function() {
              if (window.webkitNotifications.checkPermission() == 0) {
                setSetting(SETTINGS.notifications_enabled, true);
                $this.val('enabled');
              }
            });
          }
        } else {
          setSetting(SETTINGS.notifications_enabled, false);
        }
      }).val(getSetting(SETTINGS.notifications_enabled) ? 'enabled' : 'disabled');
      
      var timeout = (getSetting(SETTINGS.notifications_timeout) / 1000) || 30;
      $('#notifications input').val(timeout).keyup(function() {
        var new_timeout = cleanTimeoutTextbox(this);
        if (new_timeout < 1) {
          new_timeout = 1;
          $(this).val(new_timeout);
        }
        setSetting(SETTINGS.notifications_timeout, new_timeout * 1000);
      }).blur(function() { $(this).keyup(); });
    }
    
    function initializeSoundSelector() {
      var select = $('#sound_alert select');
      var play_button = $('#play_sound');
      var new_button = $('#new_sound');
      var new_form = $('#new_sound_form');
      
      new_form.css({
        top: (window.innerHeight - new_form.height()) / 2,
        left: (window.innerWidth - new_form.width()) / 2
      });
      
      var custom_sounds = getSetting(SETTINGS.custom_sounds) || [];
      $.each(custom_sounds, function(i, v) {
        $('<option>').text(v.name).attr('value', v.url).appendTo(select);
      });
      
      select.change(function() {
        var audio_file = select.val();
        
        setSetting(SETTINGS.sound_alert, audio_file);
        
        play_button.attr({ disabled: audio_file == '' });
      });
      
      play_button.click(function() {
        select.attr({ disabled: true });
        play_button.attr({ disabled: true });
        
        var audio = new Audio(select.val());
        
        audio.addEventListener('ended', function() {
          select.attr({ disabled: false });
          play_button.attr({ disabled: false });
        });
        audio.play();
      });
      
      new_button.click(function() {
        $('input', new_form).val('');
        grayOut(true);
        new_form.fadeIn();
      });
      
      $('#new_sound_cancel').click(function() {
        grayOut(false);
        new_form.fadeOut();
      });
      
      $('#new_sound_create').click(function() {
        var name = $('#new_sound_name').val();
        var url = $('#new_sound_url').val();
        var create_button = $(this);
        
        if (!(url && name)) {
          alert(chrome.i18n.getMessage('new_sound_prompt'));
          return;
        }
        
        create_button.attr('disabled', true);
        create_button.css('cursor', 'progress');
        
        var restoreCreateButton = function() {
          create_button.attr('disabled', false);
          create_button.css('cursor', 'auto');
        }
        
        new Audio(url).addEventListener('error', function() {
          alert(chrome.i18n.getMessage('new_sound_failed'));
          restoreCreateButton();
        });
        new Audio(url).addEventListener('canplaythrough', function() {
          var custom_sounds = getSetting(SETTINGS.custom_sounds) || [];
          custom_sounds.push({ name: name, url: url });
          setSetting(SETTINGS.custom_sounds, custom_sounds);
          
          $('<option>').text(name).attr('value', url).appendTo(select);
          
          restoreCreateButton();
          grayOut(false);
          new_form.fadeOut();
        });
      });
      
      select.val(getSetting(SETTINGS.sound_alert) || '');
      select.change();
    }
    
    function initializeExporter() {
      var form = $('#export_form');
      
      $('#export').click(function() {
        exportPagesList(function(result) {
          $('textarea', form).val(result);
          grayOut(true);
          form.fadeIn();
        });
      });
    
      $('button', form).click(function() {
        form.fadeOut();
        grayOut(false);
      });
    }
    
    function initializeImporter() {
      var form = $('#import_form');
      
      $('#import').click(function() {
        grayOut(true);
        form.fadeIn();
      });
        
      $('#import_cancel', form).click(function() {
        form.fadeOut();
        grayOut(false);
      });
      
      $('#import_perform', form).click(function() {
        var count = 0;
        try {
          count = importPagesList($('textarea', form).val());
        } catch (e) {
          alert(chrome.i18n.getMessage('import_error'));
          form.fadeOut();
          grayOut(false);
          return;
        }
        if (count) {
          var singular = chrome.i18n.getMessage('import_success_single');
          var plural = chrome.i18n.getMessage('import_success_multi', count.toString());
          alert(count == 1 ? singular : plural);
          fillPagesList();
        } else {
          alert(chrome.i18n.getMessage('import_empty'));
        }
        form.fadeOut();
        grayOut(false);
      });
    }
    
    function initializeTimeoutTextbox() {
      var timeout = Math.round(getSetting(SETTINGS.check_interval) / (60 * 1000));
      
      $('#global_timeout input').val(timeout).keyup(function() {
        setSetting(SETTINGS.check_interval, cleanTimeoutTextbox(this) * 60 * 1000);
      }).blur(function() { $(this).keyup(); });
    }
    
    function cleanTimeoutTextbox(textbox) {
      var caret_pos = textbox.selectionStart;
      var caret_end = textbox.selectionEnd;
      
      var str_timeout = $(textbox).val().replace(/[^.0-9]/g, '');
      var new_timeout = parseFloat(str_timeout) || 1;
      
      if (new_timeout <= 5 / 60) {
        new_timeout = 5 / 60;
      }
      
      if (str_timeout.match(/^0*\.|\.0*$/)) {
        $(textbox).val(str_timeout);
      } else {
        $(textbox).val(new_timeout);
      }
      
      textbox.selectionStart = caret_pos;
      textbox.selectionEnd = caret_end;
      
      return new_timeout;
    }
    
    // Returns the URL of the page record given any element in it.
    function findUrl(context) {
      return $(context).closest('.page_record').find('.page_link').get()[0].href;
    }
    
    function fillPagesList() {
      var global_check_interval = getSetting(SETTINGS.check_interval);
      getAllPages(function(pages) {
        // Sort the pages.
        var sort_order = getSetting(SETTINGS.sort_by);
        if (sort_order != 'date added') {
          pages.sort(function(a, b) {
            if (sort_order == 'name') {
              a = a.name;
              b = b.name;
            } else if (sort_order == 'check interval') {
              a = a.check_interval || global_check_interval;
              b = b.check_interval || global_check_interval;
            } else if (sort_order == 'last check') {
              a = -a.last_check;
              b = -b.last_check;
            } else if (sort_order == 'last changed') {
              a = -a.last_changed || 0;
              b = -b.last_changed || 0;
            }
            
            return (a < b) ? -1 : 1;
          });
        }
        
        // Clear the list.
        $('#pages').html('');
        
        // Fill the list.
        if (pages.length > 0) {
          $.each(pages, function(_, page) {
            var page_record = $('#templates .page_record').clone();
            var check_interval = page.check_interval || global_check_interval;
            var advanced_set = false;
        
            var name = page.name || chrome.i18n.getMessage('untitled', page.url);
            if (name.length > 60) {
              name = name.replace(/([^]{20,60})(\w)\b.*$/, '$1$2...');
            }
            
            page_record.find('.page_link').attr({
              href: page.url
            }).text(name);
            
            page_record.find('.favicon').attr({
              src: page.icon || 'img/page.png'
            });
            
            var last_check_span = page_record.find('.last_check_time');
            last_check_span.bind('time_updated', function() {
              var $span = $(this);
              getPage(page.url, function(page) {
                var last_check = page.last_check ? describeTimeSince(page.last_check) : chrome.i18n.getMessage('never');
                
                if (last_check != $span.text()) {
                  $span.fadeOut('slow', function() {
                    $span.text(last_check).fadeIn('slow');
                  });
                }
              });
            });
            last_check_span.trigger('time_updated');
            setInterval(function() { last_check_span.trigger('time_updated'); }, 15000);
            
            var timeout = check_interval / (60 * 1000);
            page_record.find('.timeout input[type=text]').val(timeout);
            if (page.check_interval) {
              page_record.find('.timeout span').addClass('enabled').removeClass('disabled');
              page_record.find('.timeout input').attr({ disabled: false });
              page_record.find('.timeout input[type=checkbox]').attr({ checked: true });
              advanced_set = true;
            }
            
            page_record.find('.mode input[type=radio]').attr({name: 'name' + crc(page.url) });
            
            if (page.mode == null) {
              if (page.regex) {
                page.mode = 'regex';
              } else {
                page.mode = 'text';
              }
            }
            if (page.mode == 'text') {
              page_record.find('.mode input[type=radio]').first().attr({ checked: true });
            } else {
              page_record.find('.mode span').first().addClass('enabled').removeClass('disabled');
              page_record.find('.mode input').attr({ disabled: false });
              page_record.find('.mode input[type=checkbox]').attr({ checked: true });
              page_record.find('.mode input[type=radio][value=' + page.mode + ']')
                         .click();
              if (page.mode == 'regex') {
                page_record.find('.mode input[type=text]').val(page.regex);
              } else if (page.mode == 'selector') {
                page_record.find('.mode input[type=text]').val(page.selector);
              }
              advanced_set = true;
            }
            
            if (advanced_set) {
              page_record.find('.advanced_toggle input[type=checkbox]').attr({ checked: true });
              page_record.find('.advanced_toggle').addClass('toggled');
              page_record.find('.advanced_controls').css({ display: 'block' });
            }
            
            page_record.appendTo('#pages');
          });
        } else {
          $('#templates .empty').clone().appendTo('#pages');
        }
      });
    }
    
    function setPageTimeout(context, timeout) {
      var url = findUrl(context);
      
      if (timeout != null) timeout = parseFloat(timeout) * 60 * 1000;
      
      setPageSettings(url, {check_interval: timeout}, BG.scheduleCheck);
    }
    
    function setPageRegex(context, regex) {
      if (regex === null)  {
        setPageSettings(findUrl(context), {regex: null, mode: 'text'});
      } else {
        var is_valid_regex = true;
        try {
          var temp_regex = new RegExp(regex);
        } catch (e) {
          is_valid_regex = false;
        }
      
        var textbox = $(context).closest('.page_record').find('.mode input[type=text]');
        var test_button = $(context).closest('.page_record').find('.mode input[type=button]');
        if (is_valid_regex) {
          textbox.removeClass('invalid');
          test_button.attr({ disabled: false });
          setPageSettings(findUrl(context), {regex: regex});
        } else {
          test_button.attr({ disabled: true });
          textbox.addClass('invalid');
        }
      }
    }
    
    function setPageSelector(context, selector) {
      if (selector === null)  {
        setPageSettings(findUrl(context), {selector: null, mode: 'text'});
      } else {
        var is_valid_selector = true;
        try {
          $(selector);
        } catch (e) {
          is_valid_selector = false;
        }
      
        var textbox = $(context).closest('.page_record').find('.mode input[type=text]');
        var test_button = $(context).closest('.page_record').find('.mode input[type=button]');
        if (is_valid_selector) {
          textbox.removeClass('invalid');
          test_button.attr({ disabled: false });
          setPageSettings(findUrl(context), {selector: selector});
        } else {
          test_button.attr({ disabled: true });
          textbox.addClass('invalid');
        }
      }
    }
    
    function exportPagesList(callback) {
      getAllPages(function(pages) {
        var buffer = [];
        var add_date = new Date().getTime();
        
        buffer.push('<!DOCTYPE NETSCAPE-Bookmark-file-1>\n\n\<\!\-\- This is an' +
                    ' automatically generated file.\n     It will be read and' +
                    ' overwritten.\n     DO NOT EDIT! \-\-\>\n<META HTTP-EQUIV=' +
                    '"Content-Type" CONTENT="text/html; charset=UTF-8">\n<TITLE>' +
                    'Bookmarks</TITLE>\n<H1>Bookmarks</H1>\n<DL><p>\n');
        
        for (var i in pages) {
          var icon_attr = pages[i].icon ? ' ICON_URI="' + pages[i].icon + '" ' : '';
          buffer.push('        <DT><A HREF="' + pages[i].url + '" ADD_DATE="' + add_date + '"' + icon_attr + '>' + pages[i].name + '</A>\n');
          
          var advanced_settings = {
            mode: pages[i].mode,
            regex: pages[i].regex,
            selector: pages[i].selector,
            check_interval: pages[i].check_interval,
            crc: pages[i].crc,
            last_check: pages[i].last_check,
            last_changed: pages[i].last_changed,
          }
          var encoded_settings = JSON.stringify(advanced_settings).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
          buffer.push('            \<\!\-\-PageMonitorAdvancedPageData=' + encoded_settings + '\-\-\>\n');
        }
        
        buffer.push('</DL><p>');
        
        (callback || $noop)(buffer.join(''));
      });
    }
    
    function importPagesList(bookmarks) {
      var page_regex = /(<[aA][^<>]+>[^<>]+<\/[aA]>)(?:\s*\<\!\-\-PageMonitorAdvancedPageData=(\{.*\})\-\-\>\n)?/g;
      var match;
      var matches_count = 0;
      
      while (match = page_regex.exec(bookmarks, page_regex.lastIndex)) {
        var page_link = $(match[1]);
        var page_url = page_link.attr('HREF') || '';
        var page_name = page_link.text() || chrome.i18n.getMessage('untitled', page_url);
        var page_icon = page_link.attr('ICON_URI') || null;
        
        var advanced = {};
        if (match[2]) {
          advanced = JSON.parse(match[2].replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>'));
        }
        
        if (page_url) {
          var page = $.extend({ url: page_url, name: page_name, icon: page_icon }, advanced);
          addPage(page);
          matches_count++;
        }
      }
      
      return matches_count;
    }
    
    $(function() {
      // Set title.
      $('title').text(chrome.i18n.getMessage('options_title'));
      
      // Apply translations.
      $('.i18n').each(function() {
        $(this).removeClass('i18n')
               .text(chrome.i18n.getMessage($(this).attr('name')))
               .attr('name', '');
      });
      
      // Turn off animations if they are disabled.
      if (getSetting(SETTINGS.animations_disabled)) $.fx.off = true;
      
      // Set up the main color/timeout/animation contols.
      initializeColorPicker();
      initializeTimeoutTextbox();
      initializeSoundSelector();
      initializeAnimationToggler();
      initializeSorter();
      initializeNotificationsChecker();
      initializeExporter();
      initializeImporter();
      
      // Set up the "Check All Now" button handler.
      $('#check_now').click(function() {
        getAllPageURLs(function(pages) {
          $('.last_check_time').text(chrome.i18n.getMessage('check_in_progress') + '..');
          
          BG.check(true, $.noop, function(url) {
            $('.last_check_time', $('#pages .page_record').has('a[href=' + url + ']')).trigger('time_updated');
          });
        });
      });
      
      // Set up "rename page" live click handlers.
      $('.rename').live('click', function() {
        var record = $(this).closest('.page_record');
        var page_link = record.find('.page_link');
        
        if (!page_link.is(':hidden')) {
          var textbox = $('<input type="text" value="' + page_link.text() + '" />');
          var cancel_button = $('<input type="button" value="' + chrome.i18n.getMessage('cancel') + '" />');
          var ok_button = $('<input type="button" value="' + chrome.i18n.getMessage('ok') + '" />');
          
          cancel_button.click(function() {
            textbox.remove();
            ok_button.remove();
            cancel_button.remove();
            page_link.show();
          });
          
          ok_button.click(function() {
            page_link.text(textbox.val());
            setPageSettings(findUrl(this), { name: textbox.val() });
            cancel_button.click();
          });
          
          page_link.hide();
          page_link.after(cancel_button).after(ok_button).after(textbox);
        }
      });
      
      // Set up "stop monitoring" live click handlers.
      $('.stop_monitoring').live('click', function() {
        var url = findUrl(this);
        
        removePage(url, BG.updateBadge);
        
        var scroll_position = scrollY;
        
        $(this).closest('.page_record td').slideUp('slow', function() {
          if ($('#pages .page_record').length == 1) {
            $('#pages').animate(
              { height: '50px', opacity: 1 }, 'slow', fillPagesList
            );
          } else {
            fillPagesList();
            scrollTo(0, scroll_position);
          }
        });
      });
      
      // Set up advanced option expansion events.
      $('.advanced_toggle input[type=checkbox]').live('click', function() {
        if ($(this).is(':checked')) {
          $(this).closest('.page_record').find('.advanced_toggle').addClass('toggled');
          $(this).closest('.page_record').find('.advanced_controls').slideDown('fast');
          
          // Apply previously-set advanced settings.
          var timeout_div = $(this).closest('.page_record').find('.timeout');
          if (timeout_div.find(':checked').length > 0) {
            setPageTimeout(this, timeout_div.find('input[type=text]').val());
          }
          var regex_div = $(this).closest('.page_record').find('.regex');
          if (regex_div.find(':checked').length > 0) {
            setPageRegex(this, regex_div.find('input[type=text]').val());
          }
        } else {
          $(this).closest('.page_record').find('.advanced_controls').slideUp('fast', function() {
            $(this).closest('.page_record').find('.advanced_toggle').removeClass('toggled');
          });
          
          setPageTimeout(this, null);
          setPageRegex(this, null);
        }
      });
      
      // Set up advanced option enabling/disabling events.
      $('.advanced_controls input[type=checkbox]').live('click', function() {
        if ($(this).is(':checked')) {
          $(this).nextAll('span').addClass('enabled').removeClass('disabled');
          $(this).nextAll('span').find('input').attr({ disabled: false });
        } else {
          $(this).nextAll('span').addClass('disabled').removeClass('enabled');
          $(this).nextAll('span').find('input').attr({ disabled: true });
        }
      });
      
      $('.timeout input[type=checkbox]').live('click', function() {
        if ($(this).is(':checked')) {
          setPageTimeout(this, $(this).nextAll('span').find('input').val());
        } else {
          setPageTimeout(this, null);
        }
      });
      
      $('.mode input[type=checkbox]').live('click', function() {
        var url = findUrl(this);
        var record = $(this).closest('.page_record');
        
        if ($(this).is(':checked')) {
          $('.mode input[type=radio]:checked', record).click();
          $('.mode input[type=text]', record).keyup();
        } else {
          setPageSettings(url, { mode: 'text', regex: null, selector: null });
        }
      });
      
      // Set advanced option editing events.
      $('.timeout input[type=text]').live('keyup', function() {
        setPageTimeout(this, cleanTimeoutTextbox(this));
      });
      $('.mode input[type=text]').live('keyup', function() {
        var mode = $(this).closest('.page_record').find('input[type=radio]:checked').val();
        if (mode == 'regex') {
          setPageRegex(this, $(this).val());
        } else if (mode == 'selector') {
          setPageSelector(this, $(this).val());
        }
      });
      
      // Set up mode radio box click handler
      $('.mode input[type=radio]').live('click', function() {
        var url = findUrl(this);
        var record = $(this).closest('.page_record');
        var val = $(this).val();
        
        setPageSettings(url, { mode: val });
        $('.mode input[type=text]', record).keyup();
        
        var label = chrome.i18n.getMessage(val);
        $('.mode_value>span', record).text(label + ':');
      });
      
      // Set up regex/selector test click handler
      $('.mode input[type=button]').live('click', function() {
        var url = findUrl(this);
        getPage(url, function(page) {
          var mode = page.mode;
          var regex = page.regex;
          var selector = page.selector;
          var button = $(this);
          
          if ((mode == 'regex' && regex) || (mode == 'selector' && selector)) {
            $(this).val(chrome.i18n.getMessage('test_progress'));
            $(this).closest('.mode').find('input').attr({ disabled: true });
            $.ajax({
              url: url,
              success: function(html) {
                var results = '';
                if (mode == 'regex') {
                  results = findAndFormatRegexMatches(html, regex);
                } else {
                  results = findAndFormatSelectorMatches(html, selector);
                }
                
                setPageSettings(url, { crc: cleanAndHashPage(html, mode, regex, selector) });
                
                if (results) {
                  alert(chrome.i18n.getMessage('test_matches') +'\n' + results);
                } else {
                  alert(chrome.i18n.getMessage('test_no_matches'));
                }
              },
              error: function() {
                alert(chrome.i18n.getMessage('test_fail'));
              },
              complete: function() {
                button.val(chrome.i18n.getMessage('test_button'));
                button.closest('.mode').find('input').attr({ disabled: false });
              }
            });
          }
        });
      });
      
      // Finally, fill the pages list.
      fillPagesList();
    });
  </script>
</head>
<body>
  <h1><span class="i18n" name="options_header"></span></h1>
  <table id="templates">
    <tr class="page_record">
      <td>
        <div class="page_info">
          <img class="favicon" src="img/page.png" />
          <a class="page_link" title="Visit Page" href="#" target="_blank">Page</a>
        </div>
        <div class="page_controls">
          <label class="util active advanced_toggle">
            <!--img src="img/plus.png" /-->
            <input type="checkbox" />
            <span class="i18n" name="advanced"></span>
          </label>
          <span class="util active rename">
            <img src="img/rename.png" />
            <span class="i18n" name="rename_page"></span>
          </span>
          <span class="util active stop_monitoring">
            <img src="img/stop_monitoring.png" />
            <span class="i18n" name="stop_monitoring"></span>
          </span>
          <span class="util last_check inactive">
            <img src="img/monitor.png" />
            <span class="i18n" name="last_check"></span>
            <span class="last_check_time"><span class="i18n" name="unknown"></span></span>.
          </span>
          <div class="advanced_controls">
            <div class="timeout">
              <input type="checkbox" />
              <span class="disabled">
                <span class="i18n" name="check_every"></span>
                <input type="text" disabled="disabled" />
              </span>
            </div>
            <div class="mode">
              <input type="checkbox" />
              <span class="mode_selector disabled">
                <span class="i18n" name="custom_mode"></span>
                <label>
                  <input type="radio" name="mode" value="regex" disabled="disabled" />
                  <span class="i18n" name="regex"></span>
                </label>
                <label>
                  <input type="radio" name="mode" value="selector" disabled="disabled" />
                  <span class="i18n" name="selector"></span>
                </label>
                <br />
                <span class="mode_value">
                  <span><span class="i18n" name="regex"></span>:</span>
                  <input type="text" disabled="disabled" />
                  <input type="button" disabled="disabled" value="Test" />
                </span>
              </span>
            </div>
          </div>
        </div>
      </td>
    </tr>
    <tr class="empty">
      <td>
        <span class="i18n" name="no_pages_monitored"></span>
      </td>
    </tr>
  </table>
  
  <table id="pages" cellspacing="0">
    <!-- Pages go here. -->
  </table>
  <p class="main_controls">
    <span class="util inactive doublewide" id="notifications">
      <img src="img/notification.png" />
      <span class="i18n" name="notifications"></span>
      <select>
        <option value="enabled" class="i18n" name="enabled"></option>
        <option value="disabled" class="i18n" name="disabled"></option>
      </select>
      <span class="i18n" name="notifications_timeout"></span>
      <input type="text" value="30" maxlength="5" style="width: 3em; text-align: center;">
    </span>
    <span class="util inactive" id="badge_color">
      <img src="img/color.png" />
      <span class="i18n" name="badge_color"></span>
      <input type="text" value="#00B400" />
    </span>
  </p>
  <p class="main_controls">
    <span class="util active" id="check_now">
      <img src="img/refresh.png" />
      <span class="i18n" name="check_all"></span>
    </span>
    <span class="util inactive" id="global_timeout">
      <img src="img/clock.png" />
      <span class="i18n" name="check_every"></span>
      <input type="text" value="180" maxlength="5" />
    </span>
  </p>
  <p class="main_controls">
    <span class="util inactive doublewide" id="sound_alert">
      <img src="img/sound.png" />
      <span class="i18n" name="sound_alert"></span>
      <select>
        <option value="" class="i18n" name="sound_none"></option>
        <option value="http://work.max99x.com/cuckoo.ogg" class="i18n" name="sound_cuckoo"></option>
        <option value="http://work.max99x.com/bell.ogg" class="i18n" name="sound_chime"></option>
      </select>
      <button id="play_sound"><span class="i18n" name="sound_play"></span></button>
      <button id="new_sound"><span class="i18n" name="sound_new"></span></button>
    </span>
  </p>
  <p class="main_controls">
    <span class="util inactive" id="sort">
      <img src="img/sort.png" />
      <span class="i18n" name="sort"></span>
      <select>
        <option value="date added" class="i18n" name="sort_date"></option>
        <option value="name" class="i18n" name="sort_name"></option>
        <option value="URL" class="i18n" name="sort_url"></option>
        <option value="check interval" class="i18n" name="sort_interval"></option>
        <option value="last check" class="i18n" name="sort_last_check"></option>
        <option value="last change" class="i18n" name="sort_last_change"></option>
      </select>
    </span>
    <span class="util inactive" id="animation">
      <img src="img/animation.png" />
      <span class="i18n" name="animations"></span>
      <select>
        <option value="enabled" class="i18n" name="enabled"></option>
        <option value="disabled" class="i18n" name="disabled"></option>
      </select>
    </span>
  </p>
  <p class="main_controls">
    <span class="util active" id="import">
      <img src="img/import.png" />
      <span class="i18n" name="import"></span>
    </span>
    <span class="util active" id="export">
      <img src="img/export.png" />
      <span class="i18n" name="export"></span>
    </span>
  </p>
  <div id="export_form">
    <span class="i18n" name="export_prompt"></span>
    <textarea wrap='off'>...</textarea>
    <button><span class="i18n" name="close"></span></button>
  </div>
  <div id="import_form">
    <span class="i18n" name="import_prompt"></span>
    <textarea wrap='off'></textarea>
    <button id="import_perform"><span class="i18n" name="import_button"></span></button>
    <button id="import_cancel"><span class="i18n" name="cancel"></span></button>
  </div>
  <div id="new_sound_form">
    <label><span class="i18n" name="sound_name"></span></label>
    <input type="text" id="new_sound_name" value="" />
    <label><span class="i18n" name="sound_url"></span></label>
    <input type="text" id="new_sound_url" value="" />
    <div id="new_sound_buttons">
      <button id="new_sound_create"><span class="i18n" name="sound_create"></span></button>
      <button id="new_sound_cancel"><span class="i18n" name="cancel"></span></button>
    </div>
  </div>
</body>
</html>